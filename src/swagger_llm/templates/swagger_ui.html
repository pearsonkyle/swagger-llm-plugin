<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="{{ swagger_css_url }}" />
    <link rel="stylesheet" type="text/css" href="{{ theme_css_url }}" />
    <!-- FOUC fix: Apply default theme immediately before page renders -->
    <script>
      (function() {
        try {
          var themeData = JSON.parse(localStorage.getItem('swagger-llm-theme') || '{"theme":"dark","customColors":{}}');
          var colors = {
            dark: { primary: '#1d4ed8', background: '#0f172a', textPrimary: '#f7fafc', secondary: '#2d3748', panelBg: '#1f2937', headerBg: '#111827', borderColor: '#4a5568', textSecondary: '#cbd5e0', inputBg: '#1f2937', accent: '#718096', primaryHover: '#1e40af' },
            light: { primary: '#2563eb', background: '#f7fafc', textPrimary: '#1a202c', secondary: '#e2e8f0', panelBg: '#ffffff', headerBg: '#edf2f7', borderColor: '#cbd5e0', textSecondary: '#4a5568', inputBg: '#f7fafc', accent: '#718096', primaryHover: '#1d4ed8' }
          };
          var theme = colors[themeData.theme] || colors.dark;
          var merged = Object.assign({}, theme, themeData.customColors || {});
          var css = ':root { --theme-primary: ' + merged.primary + '; --theme-primary-hover: ' + (merged.primaryHover || merged.primary) + '; --theme-background: ' + merged.background + '; --theme-text-primary: ' + merged.textPrimary + '; --theme-secondary: ' + merged.secondary + '; --theme-panel-bg: ' + (merged.panelBg || merged.secondary) + '; --theme-header-bg: ' + (merged.headerBg || merged.background) + '; --theme-border-color: ' + (merged.borderColor || merged.secondary) + '; --theme-text-secondary: ' + (merged.textSecondary || '#6b7280') + '; --theme-input-bg: ' + (merged.inputBg || merged.secondary) + '; --theme-accent: ' + merged.accent + '; }';
          var style = document.createElement('style');
          style.id = 'swagger-llm-theme-styles';
          style.textContent = css;
          document.head.appendChild(style);
        } catch(e) {}
      })();
    </script>
  </head>
  <body>
    <div id="swagger-ui"></div>

    <script src="{{ swagger_js_url }}"></script>
    <script src="{{ llm_settings_js_url }}"></script>
    <script src="{{ llm_layout_js_url }}"></script>

    <style>
      /* LLM Panel CSS - scoped to avoid conflicts */
      #llm-settings-panel {
        font-family: 'Inter', 'Segoe UI', sans-serif;
      }
      .llm-provider-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        margin-right: 8px;
        color: #fff;
      }
      .llm-provider-openai { background-color: #10a37f; }
      .llm-provider-anthropic { background-color: #d97757; }
      .llm-provider-ollama { background-color: #2b90d8; }
      .llm-provider-lmstudio { background-color: #6366f1; }
      .llm-provider-vllm { background-color: #facc15; color: #1a1a1a; }
      .llm-provider-azure { background-color: #0078d4; }
    </style>

    <script>
      // Read LLM settings from localStorage (set by the LLMSettingsPanel)
      var STORAGE_KEY = "swagger-llm-settings";

      function getLLMSettings() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : {};
        } catch (e) {
          return {};
        }
      }

      window.onload = function () {
        var ui = SwaggerUIBundle({
          url: "{{ openapi_url }}",
          dom_id: "#swagger-ui",
          presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
          plugins: [
            SwaggerUIBundle.plugins.DownloadUrl,
            LLMSettingsPlugin,
            LLMLayoutPlugin,
          ],
          layout: "LLMDocsLayout",
        });
        window.ui = ui;
      };
    </script>
  </body>
</html>
